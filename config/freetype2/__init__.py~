import os
from SCons.Script import *
import config


def configure(conf):
    env = conf.env

    conf.CBCheckHome('freetype2')

    if not os.environ.has_key('FREETYPE2_INCLUDE'):
        try:
            env.ParseConfig('freetype-config --cflags')
        except OSError: pass

    if env['PLATFORM'] == 'darwin':
        if not conf.CheckOSXFramework('CoreServices'):
            raise Exception, 'Need CoreServices framework'

    conf.CBRequireCHeader('ft2build.h')
    conf.CBRequireLib('freetype')

    conf.CBCheckHome('zlib', lib_suffix = '') # TODO Hack!
    conf.CBRequireLib('z')
    conf.CBCheckLib('png')

    return True


def generate(env):
    env.CBAddConfigTest('freetype2', configure)
    env.CBLoadTool('osx')


def exists():
    return 1
