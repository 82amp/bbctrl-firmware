#!/usr/bin/env python3

import os
import sys
import resource
import subprocess

# Limit memory usage
limit = 1.5e9
resource.setrlimit(resource.RLIMIT_DATA, (limit, limit))

# Clear browser errors
prefs = '/home/pi/.config/chromium/Default/Preferences'
subprocess.run(
    ('sed', '-i', 's/"exited_cleanly":false/"exited_cleanly":true/', prefs))
subprocess.run(
    ('sed', '-i', 's/"exit_type":"Crashed"/"exit_type":"Normal"/', prefs))

# Start browser
cmd = '/usr/lib/chromium-browser/chromium-browser'
args = (
  '--no-first-run',
  '--disable-infobars',
  '--noerrdialogs',
  '--single-process',
  'http://localhost/'
)
os.execvp(cmd, args)
